---
title: "Coal Plants Selection Criteria"
author: "Robert Cline"
date: "10/21/2021"
output:
  html_document:
    toc: true
---

```{r setup, include=FALSE, echo=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = FALSE,
                      warning=FALSE,
                      message = FALSE)
library(readr)
library(tidyverse)
library(ggplot2)
``` 

```{r echo=FALSE}
df <- read_csv("df.csv")
```

#### Coal Plants  
Coal Plants included in this analysis are selected based upon the following Criteria obtained from the [European Coal Database (ECD)](https://beyond-coal.eu/database/)  database:^[1. Under license an Open Database License (ODbL) v1.0. The full license can be found [here](https://opendatacommons.org/licenses/odbl/1-0/).]  
*  Greater than 800 MW per year.  
*  Closing dates between January 2018 up to and including planned closings in the year 2029. 

<br> 

 
```{r echo=FALSE, include=FALSE} 

## https://www.learnbymarketing.com/tutorials/linear-regression-in-r/ 

lignite <- df %>% 
  filter(fuel_type == "lignite")  
  
fitlignite <- lm(co2 ~ MW, data=lignite)

summary(fitlignite)

predict(fitlignite, data.frame(MW=800))
```

#### Lignite Plants  

The $CO_2$ emissions for lignite are predicted based upon the formula:   
  *fit* <- lm($CO_2$ ~ MW, data= lignite) where lignite is the tonnes of $CO_2$ production per year from lignite fuel type.    

Lignite plants are selected based upon the estimation of $CO_2$ emissions greater than **`r predict(fitlignite, data.frame(MW=800))` tonnes** of coal per year which is the prediction of 800 MW per year production capacity.   

```{r echo=FALSE} 
# Support for sjPlot https://github.com/Rapporter/pander/issues/298 

# fitlignite <- lm(co2 ~ MW, data=lignite)
sjPlot::tab_model(
  fitlignite,
  title = "CO2 Emissions as MW Predictor for Lignite Coal Plant",
  show.r2 = TRUE,
  show.icc = FALSE,
  show.re.var = FALSE,
  p.style = "scientific",
  emph.p = TRUE) #, include to save as html
#  file = "Downloads/temp.html")

```
<br>




#### Hard Coal Plants 

 
```{r echo=FALSE, include=FALSE} 

## https://www.learnbymarketing.com/tutorials/linear-regression-in-r/ 

hardCoal <- df %>% 
  filter(fuel_type == "hard coal")  
  
fithardCoal <- lm(co2 ~ MW, data=hardCoal)

summary(fithardCoal)

predict(fithardCoal, data.frame(MW=800))
```

The $CO_2$ emissions for lignite are predicted based upon the formula:   
  *fit_hardCoal* <- lm($CO_2$ ~ MW, data= hardCoal) where lignite is the tonnes of $CO_2$ production per year from hard coal fuel type.    

Hard coal coal plants are selected based upon the estimation of $CO_2$ emissions greater than **`r predict(fithardCoal, data.frame(MW=800))` tonnes** of coal per year representing 800 MW and greater production capacity.   

```{r echo=FALSE} 
# Support for sjPlot https://github.com/Rapporter/pander/issues/298 

# fitlignite <- lm(co2 ~ MW, data=lignite)
sjPlot::tab_model(
  fithardCoal,
  title = "CO2 Emissions as MW Predictor for Coal Plant with hard coal fuel type",
  show.r2 = TRUE,
  show.icc = FALSE,
  show.re.var = FALSE,
  p.style = "scientific",
  emph.p = TRUE) #, include to save as html
#  file = "Downloads/temp.html")

```
<br>

### Analysis of Residuals of fitted linear models 
The analyis of the residuals of the fitted linear models suggest that the linear models represent, not perfect, but reasonable predictors of $CO_2$ emissions to predict a coal plant's power capacity, particularly within the interquartile range.  

### Hard Coal Residuals
```{r eval=FALSE, message=FALSE, warning=FALSE, include=FALSE}

fit <- lm(co2 ~ MW, data = df) # fit the model
df$predicted <- predict(fit)   # Save the predicted values
df$residuals <- residuals(fit) # Save the residual values
ggplot(df, aes(x = MW, y = co2)) +
  geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +     # regression line  
  geom_segment(aes(xend = MW, yend = predicted), alpha = .2) +      # draw line from point to line
  geom_point(aes(color = abs(residuals), size = abs(residuals))) +  # size of the points
  scale_color_continuous(low = "green", high = "red") +             # colour of the points mapped to residual size - green smaller, red larger
  guides(color = FALSE, size = FALSE) +                             # Size legend removed
  geom_point(aes(y = predicted), shape = 1) + 
  labs(title = "Residuals for Hard coal and lignite")
  theme_bw()
```




```{r eval=TRUE} 
# summary(hc)

hc <- df %>% 
  filter(fuel_type=="hard coal")

lc <- df %>% 
  filter(fuel_type=="lignite")


fithc <- lm(co2 ~ MW, data = hc) # fit the model

hc$predicted <- predict(fithc)   # Save the predicted values
hc$residuals <- residuals(fithc) # Save the residual values
ggplot(hc, aes(x = MW, y = co2)) +
  geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +     # regression line  
  geom_segment(aes(xend = MW, yend = predicted), alpha = .2) +      # draw line from point to line
  geom_point(aes(color = abs(residuals), size = abs(residuals))) +  # size of the points
  scale_color_continuous(low = "green", high = "red") +             # colour of the points mapped to residual size - green smaller, red larger
  guides(color = FALSE, size = FALSE) +                             # Size legend removed
  geom_point(aes(y = predicted), shape = 1) +
labs(title="Hard Coal residuals") +
  theme_bw()
``` 

**Residuals vs Fitted** residuals should be equally spread around the horizontal lline without a distinct pattern
```{r}
plot(fithc, which=1, col=c("blue"),
     main="Hard coal")
``` 


**Q-Q plot** residuals should show reasonable alignment with fit line
```{r}
plot(fithc, which=2, col=c("blue"),
     main="Hard coal")
```


**Scale-Location** residuals should be spaced equally above and below the line
```{r eval=FALSE}
plot(fitlc, which=3, col=c("blue"),
     main="Hard coal") 
```

<br>

### Lignite residuals
```{r}
lc <- df %>% 
  filter(fuel_type=="lignite")


fitlc <- lm(co2 ~ MW, data = lc) # fit the model

lc$predicted <- predict(fitlc)   # Save the predicted values
lc$residuals <- residuals(fitlc) # Save the residual values
ggplot(lc, aes(x = MW, y = co2)) +
  geom_smooth(method = "lm", se = FALSE, color = "lightgrey") +     # regression line  
  geom_segment(aes(xend = MW, yend = predicted), alpha = .2) +      # draw line from point to line
  geom_point(aes(color = abs(residuals), size = abs(residuals))) +  # size of the points
  scale_color_continuous(low = "green", high = "red") +             # colour of the points mapped to residual size - green smaller, red larger
  guides(color = FALSE, size = FALSE) +                             # Size legend removed
  geom_point(aes(y = predicted), shape = 1) +
labs(title="Lignite Coal residuals") +
  theme_bw()
```


**Residuals vs Fitted** residuals should be equally spread around the horizontal lline without a distinct pattern
```{r}
plot(fitlc, which=1, col=c("blue"),
     main="Lignite coal")
``` 

**Q-Q plot** residuals should show reasonable alignment with fit line
```{r}
plot(fitlc, which=2, col=c("blue"),
     main="Lignite coal")
``` 

**Scale-Location** residuals should be spaced equally above and below the line
```{r}
plot(fitlc, which=3, col=c("blue"),
     main="Lignite coal") 
```

